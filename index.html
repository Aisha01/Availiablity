<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8"/>
		<title>Learn Type Specific</title>

		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet" />

		<!-- The main CSS file -->
		<link href="style.css" rel="stylesheet" />

		<!--[if lt IE 9]>
			<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script>

        var currentLocation = window.location.href;
        console.log(currentLocation);
        var type = window.location.hash.substr(1);
        console.log(type);
			
				
        var accessToken = null;
        var pathArray = type.split( '&' );
				
        for (i = 0; i < pathArray.length; i++) {
						
						
            var currentItem = pathArray[i];
            if(i == 2){
                var splitByEqual = currentItem.split('=');
                console.log(splitByEqual[0]);
                console.log(splitByEqual[1]);
                accessToken = splitByEqual[1];
						
					
            }
            console.log(currentItem);
					

        }
			
        var auth = 'Bearer '+accessToken;
					
					
        $(document).ready(function () {

					
					
            console.log("Access Token is " + accessToken );

					
            $('#getRooms').on('click', function(){
					
					
                $('div.rooms > div.chat').empty();
					
                console.log("I am called");
                alert("hello" + auth);
					
                $.ajax({
                    type: 'GET',
                    url: 'https://api.ciscospark.com/v1/memberships',
                    headers : {
                        'Access-Control-Allow-Origin': 'https://availiable.azurewebsites.net',
                        'Access-Control-Allow-Methods': 'POST, GET, PUT, DELETE',
                        'contentType': 'application/json; charset=utf-8',
							

                        'Authorization': auth 

                    },
							
							
                    success: function (r) {
								
                        console.log(r);
                        var s = JSON.stringify(r);
                        var c = JSON.parse(s);
                        console.log(c);
                        for (var i = 0; i < c.items.length; i++) {
                            var objPerson = c.items[i];
                            var roomId = objPerson.roomId;

                            
                            console.log(objPerson.id);
                            console.log(objPerson.personDisplayName);
                            var roomURL = 'https://api.ciscospark.com/v1/rooms/' + roomId;
                            console.log(roomURL);


                            $.ajax({
                                type: 'GET',
                                url: roomURL,
                                headers: {
                                    'Access-Control-Allow-Origin': 'https://availiable.azurewebsites.net',
                                    'Access-Control-Allow-Methods': 'POST, GET, PUT, DELETE',
                                    'contentType': 'application/json; charset=utf-8',
                                    'Authorization': auth

                                },
                                success: function (data) {
                                    console.log(data);
                                    var stringify = JSON.stringify(data);
					
                                    var jsonObj = JSON.parse(stringify);
					
                                    console.log(jsonObj.id);
                                    console.log(jsonObj.title);
					
                                    $('div.rooms > div.chat').append('<span class="title">' + jsonObj.title + ' </span><br /><input type="button" name="Message" id=" ' + objPerson.roomId + '" value="Start Chat" class="btn button btnMsg"/>');
				
					
				    $('.btnMsg').on('click',function(){var change = this; console.log(change.id);});
		

                                },
                                error: function (data) {


                                }

                            })
                        }
	
                    },
                    error: function (r) {
                        alert('error' + r);
                    }
				
                });
					
            });

		
        })
			
       




    </script>
		
	<style type="text/css">
        .chat {
           
            width: 200px;
            margin-top: 14px;
            margin-left: 16px;
	    margin-bottom: 30px;
        }

      .btn  {
            margin-left: 113px;
            margin-top: 48px;
        }
    </style>
	
	</head>

	<!-- Notice the controller directive -->
	<body ng-app ng-controller="InlineEditorController">

		<!-- When this element is clicked, hide the tooltip -->
		<div id="main" ng-click="hideTooltip()">

			<!-- This is the tooltip. It is shown only when the showtooltip variable is truthful -->
			<div class="tooltip" ng-click="$event.stopPropagation()" ng-show="showtooltip">

				<!-- ng-model binds the contents of the text field with the "value" model.
					 Any changes to the text field will automatically update the value, and
					 all other bindings on the page that depend on it.  -->

				<input type="text" ng-model="value" />
			</div>

			<!-- Call a method defined in the InlineEditorController that toggles
			 the showtooltip varaible -->
			<p ng-click="toggleTooltip($event)">{{value}}</p>
			
		  <input type="button"  id="getRooms" Value="Get Rooms" class="button success" />
        
       			 <div class="rooms">
					 <div class="chat">

            				</div>
       			 </div>
			

		</div>

		<!-- Include AngularJS from Google's CDN -->
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
		<script src="script.js"></script>
		</body>
</html>
